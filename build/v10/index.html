<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://public-frontend-cos.metadl.com/mgx/img/favicon.png" type="image/png">
  <title>نظام إدارة الأداء - التسويق الخيري المتقدم</title>
  <meta name="description" content="نظام متكامل لإدارة الأداء في التسويق الخيري مع ذكاء اصطناعي متقدم وأنظمة تحفيز ذكية" />
  <meta name="author" content="MGX" />
  <meta name="keywords" content="إدارة الأداء, التسويق الخيري, الذكاء الاصطناعي, نظام المكافآت, إدارة الفرق" />

  <meta property="og:title" content="نظام إدارة الأداء - التسويق الخيري المتقدم" />
  <meta property="og:description" content="نظام متكامل لإدارة الأداء في التسويق الخيري مع ذكاء اصطناعي متقدم وأنظمة تحفيز ذكية" />
  <meta property="og:type" content="website" />

  <!-- Arabic Font Support -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Cairo', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      direction: rtl;
    }

    /* إصلاح نظام الإشعارات - تحديث محسّن */
    [data-sonner-toaster] {
      position: fixed !important;
      bottom: 20px !important;
      left: 20px !important;
      right: auto !important;
      z-index: 999999 !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 12px !important;
      pointer-events: none !important;
    }

    [data-sonner-toast] {
      pointer-events: all !important;
      background: white !important;
      border: 1px solid #e5e7eb !important;
      border-radius: 12px !important;
      padding: 16px 20px !important;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
      min-width: 320px !important;
      max-width: 400px !important;
      animation: slideInLeft 0.3s cubic-bezier(0.16, 1, 0.3, 1) !important;
      opacity: 1 !important;
      display: flex !important;
      align-items: start !important;
      gap: 12px !important;
    }

    @keyframes slideInLeft {
      from {
        transform: translateX(-100%) scale(0.95);
        opacity: 0;
      }
      to {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
    }

    @keyframes slideInLeft {
      from {
        transform: translateX(-100%) scale(0.95);
        opacity: 0;
      }
      to {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
    }

    @keyframes slideOutLeft {
      from {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
      to {
        transform: translateX(-100%) scale(0.95);
        opacity: 0;
      }
    }

    /* أيقونات الإشعارات */
    [data-sonner-toast][data-type="success"]::before {
      content: "✅";
      font-size: 20px;
      display: block;
    }

    [data-sonner-toast][data-type="error"]::before {
      content: "❌";
      font-size: 20px;
      display: block;
    }

    [data-sonner-toast][data-type="warning"]::before {
      content: "⚠️";
      font-size: 20px;
      display: block;
    }

    [data-sonner-toast][data-type="info"]::before {
      content: "ℹ️";
      font-size: 20px;
      display: block;
    }

    /* ألوان الإشعارات */
    [data-sonner-toast][data-type="success"] {
      border-right: 4px solid #10b981 !important;
      background: #f0fdf4 !important;
    }

    [data-sonner-toast][data-type="error"] {
      border-right: 4px solid #ef4444 !important;
      background: #fef2f2 !important;
    }

    [data-sonner-toast][data-type="warning"] {
      border-right: 4px solid #f59e0b !important;
      background: #fffbeb !important;
    }

    [data-sonner-toast][data-type="info"] {
      border-right: 4px solid #3b82f6 !important;
      background: #eff6ff !important;
    }

    /* نص الإشعار */
    [data-sonner-toast] [data-title] {
      font-weight: 600 !important;
      font-size: 14px !important;
      margin-bottom: 4px !important;
    }

    [data-sonner-toast] [data-description] {
      font-size: 13px !important;
      color: #6b7280 !important;
    }

    /* زر الإغلاق */
    [data-sonner-toast] [data-close-button] {
      position: absolute !important;
      top: 8px !important;
      left: 8px !important;
      right: auto !important;
      opacity: 0.5 !important;
      transition: opacity 0.2s !important;
    }

    [data-sonner-toast] [data-close-button]:hover {
      opacity: 1 !important;
    }
  </style>
  <script type="module" crossorigin src="/assets/index-Bwri3W_O.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-FnOYCDch.css">
  
  <script>
    // إضافة زر "إنشاء مهمة جديدة" تلقائياً
    window.addEventListener('load', function() {
      setTimeout(function() {
        // البحث عن صفحة المهام
        const taskHeader = Array.from(document.querySelectorAll('h1, h2')).find(el => 
          el.textContent.includes('إدارة المهامم') || el.textContent.includes('إدارة المهام')
        );
        
        if (taskHeader && !document.getElementById('add-task-btn')) {
          const headerContainer = taskHeader.parentElement;
          
          // إنشاء زر الإضافة
          const addButton = document.createElement('button');
          addButton.id = 'add-task-btn';
          addButton.textContent = '+ إنشاء مهمة جديدة';
          addButton.style.cssText = `
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Cairo', sans-serif;
          `;
          
          addButton.onmouseover = () => addButton.style.background = '#2563eb';
          addButton.onmouseout = () => addButton.style.background = '#3b82f6';
          
          addButton.onclick = function() {
            showTaskModal();
          };
          
          headerContainer.appendChild(addButton);
        }
      }, 1000);
    });

    // نافذة إضافة مهمة
    function showTaskModal() {
      // إنشاء الخلفية
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
      `;
      
      // إنشاء النافذة
      const modal = document.createElement('div');
      modal.style.cssText = `
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
      `;
      
      modal.innerHTML = `
        <h2 style="margin: 0 0 20px 0; font-size: 20px;">إنشاء مهمة جديدة</h2>
        <form id="task-form">
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">عنوان المهمة *</label>
            <input type="text" id="task-title" required style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Cairo', sans-serif;" />
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">الوصف</label>
            <textarea id="task-description" rows="3" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Cairo', sans-serif;"></textarea>
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">المسؤول</label>
            <input type="text" id="task-assignee" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Cairo', sans-serif;" />
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">الأولوية</label>
              <select id="task-priority" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Cairo', sans-serif;">
                <option value="low">منخفضة</option>
                <option value="medium" selected>متوسطة</option>
                <option value="high">عالية</option>
                <option value="urgent">عاجلة</option>
              </select>
            </div>
            
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">الحالة</label>
              <select id="task-status" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Cairo', sans-serif;">
                <option value="pending" selected>معلقة</option>
                <option value="in-progress">قيد التنفيذ</option>
                <option value="completed">مكتملة</option>
                <option value="blocked">محظورة</option>
              </select>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">تاريخ الاستحقاق</label>
            <input type="date" id="task-date" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Cairo', sans-serif;" />
          </div>
          
          <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button type="button" onclick="closeTaskModal()" style="padding: 10px 20px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; font-family: 'Cairo', sans-serif;">إلغاء</button>
            <button type="submit" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Cairo', sans-serif;">إنشاء المهمة</button>
          </div>
        </form>
      `;
      
      overlay.appendChild(modal);
      document.body.appendChild(overlay);
      
      // معالج النموذج
      document.getElementById('task-form').onsubmit = function(e) {
        e.preventDefault();
        
        const taskData = {
          title: document.getElementById('task-title').value,
          description: document.getElementById('task-description').value,
          assignedTo: document.getElementById('task-assignee').value || 'غير محدد',
          priority: document.getElementById('task-priority').value,
          status: document.getElementById('task-status').value,
          dueDate: document.getElementById('task-date').value || new Date().toISOString().split('T')[0],
          projectId: 'project_default',
          projectName: 'مشروع افتراضي'
        };
        
        // إنشاء المهمة
        try {
          if (window.bt && window.bt.createTask) {
            window.bt.createTask(taskData);
            
            // إظهار إشعار نجاح
            if (window.showNotification) {
              window.showNotification(
                'تم إنشاء المهمة بنجاح',
                `المهمة "${taskData.title}" تم إضافتها بنجاح`,
                'success'
              );
            }
            
            closeTaskModal();
            setTimeout(() => location.reload(), 1000); // تحديث الصفحة بعد ثانية
          } else {
            // إظهار إشعار خطأ
            if (window.showNotification) {
              window.showNotification(
                'خطأ في النظام',
                'نظام المهام غير متوفر حالياً',
                'error'
              );
            } else {
              alert('❌ خطأ: نظام المهام غير متوفر');
            }
          }
        } catch (error) {
          // إظهار إشعار خطأ
          if (window.showNotification) {
            window.showNotification(
              'حدث خطأ',
              error.message,
              'error'
            );
          } else {
            alert('❌ حدث خطأ: ' + error.message);
          }
        }
      };
      
      window.closeTaskModal = function() {
        overlay.remove();
      };
      
      overlay.onclick = function(e) {
        if (e.target === overlay) closeTaskModal();
      };
    }

    // نظام الإشعارات الكامل والعامل
    window.showNotification = function(title, description, type) {
      type = type || 'info';
      
      // إنشاء container للإشعارات إذا لم يكن موجوداً
      let toaster = document.querySelector('[data-sonner-toaster]');
      if (!toaster) {
        toaster = document.createElement('ol');
        toaster.setAttribute('data-sonner-toaster', '');
        toaster.setAttribute('data-theme', 'light');
        toaster.setAttribute('data-y-position', 'bottom');
        toaster.setAttribute('data-x-position', 'left');
        toaster.style.cssText = `
          position: fixed;
          bottom: 20px;
          left: 20px;
          z-index: 999999;
          display: flex;
          flex-direction: column;
          gap: 12px;
          pointer-events: none;
        `;
        document.body.appendChild(toaster);
      }
      
      // إنشاء الإشعار
      const toast = document.createElement('li');
      toast.setAttribute('data-sonner-toast', '');
      toast.setAttribute('data-type', type);
      toast.setAttribute('data-styled', 'true');
      toast.setAttribute('data-mounted', 'true');
      toast.setAttribute('data-visible', 'true');
      toast.style.cssText = `
        pointer-events: all;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px 20px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        min-width: 320px;
        max-width: 400px;
        animation: slideInLeft 0.3s ease;
        display: flex;
        align-items: start;
        gap: 12px;
      `;
      
      // تطبيق الألوان حسب النوع
      const colors = {
        'success': { border: '#10b981', bg: '#f0fdf4', icon: '✅' },
        'error': { border: '#ef4444', bg: '#fef2f2', icon: '❌' },
        'warning': { border: '#f59e0b', bg: '#fffbeb', icon: '⚠️' },
        'info': { border: '#3b82f6', bg: '#eff6ff', icon: 'ℹ️' }
      };
      
      const style = colors[type] || colors.info;
      toast.style.borderRight = `4px solid ${style.border}`;
      toast.style.background = style.bg;
      
      // محتوى الإشعار
      toast.innerHTML = `
        <span style="font-size: 20px; display: block;">${style.icon}</span>
        <div style="flex: 1;">
          <div data-title style="font-weight: 600; font-size: 14px; margin-bottom: 4px; font-family: 'Cairo', sans-serif;">
            ${title}
          </div>
          ${description ? `<div data-description style="font-size: 13px; color: #6b7280; font-family: 'Cairo', sans-serif;">
            ${description}
          </div>` : ''}
        </div>
        <button data-close-button style="
          position: absolute;
          top: 8px;
          left: 8px;
          width: 20px;
          height: 20px;
          border: 1px solid #e5e7eb;
          border-radius: 50%;
          background: white;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          opacity: 0.5;
          transition: opacity 0.2s;
        ">×</button>
      `;
      
      toaster.appendChild(toast);
      
      // حذف الإشعار بعد 4 ثوانٍ
      const removeToast = () => {
        toast.style.animation = 'slideOutLeft 0.3s ease';
        setTimeout(() => {
          toast.remove();
          // حذف container إذا كان فارغاً
          if (toaster.children.length === 0) {
            toaster.remove();
          }
        }, 300);
      };
      
      setTimeout(removeToast, 4000);
      
      // زر الإغلاق
      toast.querySelector('[data-close-button]').onclick = removeToast;
      
      return toast;
    };

    // دالة الاختبار
    window.testNotification = function() {
      showNotification('اختبار الإشعار', 'نظام الإشعارات يعمل بشكل صحيح! ✅', 'success');
    };

    // ربط نظام الإشعارات مع نظام المهام
    window.addEventListener('load', function() {
      setTimeout(function() {
        // Override original task creation to show notifications
        if (window.bt && window.bt.createTask) {
          const originalCreateTask = window.bt.createTask;
          window.bt.createTask = function(taskData) {
            try {
              originalCreateTask.call(this, taskData);
              showNotification('✅ تم إنشاء المهمة', `المهمة "${taskData.title}" تم إضافتها بنجاح`, 'success');
            } catch (error) {
              showNotification('❌ خطأ', 'فشل إنشاء المهمة: ' + error.message, 'error');
              throw error;
            }
          };
        }
        
        console.log('✅ Notification system ready. Type testNotification() to test.');
      }, 2000);
    });
  </script>
</head>

<body>
  <div id="root"></div>
</body>

</html>