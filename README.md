# Tawq Impact Platform

منصة خلفية (Backend) أولية مبنية بـ [FastAPI](https://fastapi.tiangolo.com/) لإدارة فرق التسويق للجمعيات الخيرية في السعودية. توفر النظام عدة وحدات تشمل الحسابات المتعددة، إدارة المشاريع والمهام، التحليلات اللحظية، ولوحة المتصدرين مع توصيات ذكية لتحسين الأداء.

## المتطلبات

- Python 3.11+
- بيئة افتراضية مفعلة

## التثبيت والتشغيل

```bash
pip install -r requirements.txt
uvicorn app.main:app --reload
```

سيعمل الخادم افتراضيًا على `http://127.0.0.1:8000` مع وثائق تلقائية عبر Swagger في `/docs`.

### كيفية استعراض البرنامج

1. بعد تشغيل الأمر السابق، افتح المتصفح وتوجه إلى:
   - واجهة برمجة التطبيقات التفاعلية (Swagger UI): `http://127.0.0.1:8000/docs`
   - واجهة Redoc التوثيقية: `http://127.0.0.1:8000/redoc`
2. لإنشاء الحسابات وتسجيل الدخول جرّب نقاط النهاية الموجودة في قسم **Auth** داخل Swagger UI.
3. يمكن اختبار بقية الوظائف (المشاريع، المهام، التحليلات) من الواجهة نفسها عبر إرسال الطلبات مباشرةً ومشاهدة الاستجابات الحية.
4. في بيئة الإنتاج يفضل تشغيل الخادم باستخدام [Uvicorn مع Gunicorn](https://www.uvicorn.org/deployment/#gunicorn) أو أي مزوّد WSGI/ASGI آخر وتوفير اسم نطاق وشهادة HTTPS قبل إتاحته للمستخدمين.

### الإعداد مع Supabase

للاستفادة من قاعدة بيانات Supabase وخدماتها، عرِّف المتغيرات البيئية التالية قبل تشغيل الخادم:

```bash
export SUPABASE_URL="https://<project>.supabase.co"
export SUPABASE_SERVICE_ROLE_KEY="<service-role-key>"
export SUPABASE_DB_URL="postgresql+psycopg://<user>:<password>@db.<project>.supabase.co:5432/postgres"
```

- إذا كنت تفضّل استخدام مفتاح واجهة البرمجة العمومية فبإمكانك استخدام `SUPABASE_ANON_KEY` بدلًا من `SUPABASE_SERVICE_ROLE_KEY` وفقًا للصلاحيات المطلوبة.
- بمجرد توفر `SUPABASE_DB_URL` سيستخدم التطبيق قاعدة بيانات Supabase تلقائيًا، مع تفعيل اتصال آمن (`sslmode=require`).
- عند عدم تعريف القيم أعلاه سيستمر التطبيق في استخدام قاعدة بيانات SQLite المحلية (`tawq.db`).

## الاختبارات

```bash
pytest
```

> **ملاحظة:** في البيئات المغلقة قد يتعذر تنزيل الاعتماديات عبر `pip`. في هذه الحالة يجب توفير الحزم المطلوبة مسبقًا أو استخدام مرآة داخلية.

## لمحة عن الوظائف الرئيسية

- **نظام الصلاحيات:** حسابات للمدير، المشرف، المحاسب، والموظف مع تفعيل وتعطيل الحسابات.
- **إدارة المشاريع:** إنشاء المشاريع، تعيين الموظفين، وتتبع الإيرادات والمصروفات.
- **إدارة المهام:** إنشاء المهام، تعيين الأولويات، تسجيل السجلات اليومية، ورصد الإيرادات لكل مهمة.
- **لوحة المتصدرين:** نقاط، إيرادات، والمهام المكتملة مع توصيات ذكية مبنية على البيانات الحديثة.
- **رؤى الموظفين:** تحليلات أسبوعية للنشاط، العوائق المتكررة، والتوصيات الشخصية.

هذا الإصدار يمثل أساسًا يمكن توسيعه لاحقًا ليشمل بقية المتطلبات مثل الجدولة الذكية، الأتمتة، ونظام التدريب المتكامل.
